# 第二章 开始

目标：hello world

## 1.1 步骤

- 创建一个.java文件
- 使用javac编译为.class
- c部分
    - 使用javah生成头文件
    - 创建实现  
    - 编译c
- java加入dll/so
- 运行

## 2.1 定义本地方法

### 2.1.1 首先定义本地方法

```java


```

- 声明使用native
- 以分号终结

### 2.1.2 编译hello world

```
javac xx.java
```

得到class

### 2.1.3 创建本地方法头

使用javah生成一个jni类型的头文件

```
javah -jni xxx
```

- JNIEnv:jvm环境
- 第二个参数是xxx对象本身

### 编写实现


```java
public class Test {
    static {
        File file = new File("jni\\libs\\Debug\\1_demo.dll");
        System.out.println(file.getAbsolutePath());
        System.load(file.getAbsolutePath());
    }

    public static void main(String[] args) {
        stringTest();
    }

    private static void stringTest() {
        StringTest test = new StringTest();
        System.out.println(test.getStr());
        System.out.println(test.sendStr("123"));
    }
}
```

```c++
#include <kw_test_example_StringTest.h>
JNIEXPORT jstring JNICALL Java_kw_test_example_StringTest_getStr(JNIEnv* env, jobject object) {


//@line:4

        const char *ch = "hello";
    jstring js = env->NewStringUTF(ch);
    return js;
    

}

static inline jstring wrapped_Java_kw_test_example_StringTest_sendStr
(JNIEnv* env, jobject object, jstring obj_str, char* str) {

//@line:10


	char* str = (char*)env->GetStringUTFChars(obj_str, 0);

    strcat(str,"xx");
    jstring js = env->NewStringUTF(str);

	env->ReleaseStringUTFChars(obj_str, str);
    return js;
    
}

JNIEXPORT jstring JNICALL Java_kw_test_example_StringTest_sendStr(JNIEnv* env, jobject object, jstring obj_str) {
	char* str = (char*)env->GetStringUTFChars(obj_str, 0);

	jstring JNI_returnValue = wrapped_Java_kw_test_example_StringTest_sendStr(env, object, obj_str, str);

	env->ReleaseStringUTFChars(obj_str, str);

	return JNI_returnValue;
}


```

xxx.h

```c++
/* DO NOT EDIT THIS FILE - it is machine generated */
#include <jni.h>
/* Header for class kw_test_example_StringTest */

#ifndef _Included_kw_test_example_StringTest
#define _Included_kw_test_example_StringTest
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     kw_test_example_StringTest
 * Method:    getStr
 * Signature: ()Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_kw_test_example_StringTest_getStr
  (JNIEnv *, jobject);

/*
 * Class:     kw_test_example_StringTest
 * Method:    sendStr
 * Signature: (Ljava/lang/String;)Ljava/lang/String;
 */
JNIEXPORT jstring JNICALL Java_kw_test_example_StringTest_sendStr
  (JNIEnv *, jobject, jstring);

#ifdef __cplusplus
}
#endif
#endif

```


### 运行

